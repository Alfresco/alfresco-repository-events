# Auto-generated .travis.yml file
# Generated 2020-11-25 09:56:56 from Bamboo build plan PLAT-REPEVENTS

language: java

jdk:
  - oraclejdk8

dist: trusty

stages:
  - name: Default Stage
  - name: Release
    if: fork = false AND (branch = master OR branch =~ /support\/.*/) AND type != pull_request AND commit_message !~ /\[no-release\]/

jobs:
  include:
    - stage: "Default Stage"
      name: "WhiteSource Scan"
      script:
        # WhiteSource License Check
        - mvn clean org.whitesource:whitesource-maven-plugin:checkPolicies
    - stage: "Default Stage"
      name: "Default Job"
      script:
        # Build + Install
        - MAVEN_OPTS="-Xmx1024m -XX:MaxPermSize=768M" mvn --batch-mode -U clean org.jacoco:jacoco-maven-plugin:prepare-agent source:jar install
    - stage: "Release"
      name: "Release"
      script:
        # Release
        - GIT_AUTHOR_NAME=alfresco-build GIT_AUTHOR_EMAIL=build@alfresco.com GIT_COMMITTER_NAME=alfresco-build GIT_COMMITTER_EMAIL=build@alfresco.com mvn --batch-mode  -DreleaseVersion=${RELEASE_VERSION}  -DdevelopmentVersion=${DEVELOPMENT_VERSION}  -DskipTests  -Djava.compiler.version=${JAVA_COMPILER_VERSION}  -Darguments=-DskipTests  release:prepare release:perform
